package pentest;

import java.security.NoSuchAlgorithmException;
import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.ResultSet;
import java.sql.ResultSetMetaData;
import java.sql.SQLException;
import java.sql.Statement;
import java.util.Scanner;

public class Main {
	public static void main(String[] args) throws NoSuchAlgorithmException {
		
	
		String ip = args[0];
        String port = args[1];
        String nameDatabase = args[2];
        String user = args[3];
        String password = args[4];
		
		System.out.println("App run. Continue? (yes/no)");
		String instrucao = "yes";
		Scanner in2 = new Scanner(System.in);
		in2.nextLine();
        
		try (Connection connection = DriverManager.getConnection("jdbc:postgresql://" + ip +":" + port + "/" + nameDatabase , user, password)) {
			
			
			System.out.println("Connected to the database!");
			Statement statement = connection.createStatement();
			
			while(instrucao.equals("yes")) {
				
				System.out.println("Enter a query:");
				Scanner in = new Scanner(System.in);
		        String sql = in.nextLine();
		        
				ResultSet resultSet = statement.executeQuery(sql);
				ResultSetMetaData rsmd = resultSet.getMetaData();
				int columnsNumber = rsmd.getColumnCount();
				while (resultSet.next()) {
				    for (int i = 1; i <= columnsNumber; i++) {
				        if (i > 1) System.out.print(" | ");
				        String columnValue = resultSet.getString(i);
				        System.out.print(rsmd.getColumnName(i) + ": " + columnValue);
				    }
				    System.out.println("\n");
				}
				
				
				
				System.out.println("New query? (yes/no)");
				in2 = new Scanner(System.in);
				in2.nextLine();
				
			}
			

		} catch (SQLException e) {
			System.out.println("Connection failure.");
			e.printStackTrace();
		}
	}

}
